import streamlit as st
import textwrap

# 페이지 설정
st.set_page_config(page_title="A2I 실습 프롬프트", layout="wide")

# CSS: 부드러운 스크롤링 효과
st.markdown(
    """
    <style>
    html {
        scroll-behavior: smooth;
    }
    </style>
    """, unsafe_allow_html=True
)

# 비밀번호 설정 (모든 프롬프트에 동일하게 적용)
PASSWORD = "1111"

# 프롬프트 목록 정의 (앞에 템플릿, 거꾸로 질문받기 추가)
prompts = [
    {
        "title": "공항 코드",
        "group": "템플릿",
        "prompt": [
            "출력물을 위한 템플릿을 제공해 드리겠습니다. 꺾쇠 괄호 <> 안의 단어가 플레이스홀더입니다. 플레이스홀더를 채워주세요. 제 템플릿의 전체 서식을 그대로 유지해 주세요. 제 템플릿은 다음과 같습니다:\n\n출발 공항: <출발 공항 이름>\n공항 코드: <출발 공항 코드>\n\n도착 공항: <도착 공항 이름>\n공항 코드: <도착 공항 코드>\n\n인천에서 파리까지 비행기를 타고 가고 싶어요.",
            "제주에서 뉴욕까지 가고 싶어요.",
            "런던에서 시드니까지 여행 가고 싶어요."
        ]
    },
    {
        "title": "질문 답변 생성",
        "group": "템플릿",
        "prompt": "결과물을 위한 템플릿을 제공해 드리겠습니다. 꺾쇠 괄호 <> 안의 단어가 플레이스홀더입니다.\n플레이스홀더를 당신의 결과물로 채워주세요. 제 템플릿의 전체 서식을 그대로 유지해 주세요. 제 템플릿은 다음과 같습니다:\n\n질문: <질문>\n대답: <답변>\n\n템플릿을 채울 데이터를 제공받으면 템플릿의 서식에 맞게 대답하세요.\n\n아래 URL에 있는 내용을 사용하여 10개의 질문을 만드세요.\nhttps://en.wikipedia.org/wiki/Korean_language"
    },
    {
        "title": "수학 공부",
        "group": "거꾸로 질문받기",
        "prompt": "나는 초등학교 5학년입니다. 수학 공부를 잘 하고 싶어요. 이 목표를 달성하기 위해 나에게 질문을 해 주세요. 충분한 정보를 얻어 나에게 적합한 수학 공부 계획을 제안할 수 있을 때까지 질문을 계속하세요. 정보를 다 모으면 수학 공부 계획을 보여 주세요. 질문을 한 번에 하나씩 하세요.\n\n첫 번째 질문을 시작해 주세요."
    },
    {
        "title": "키 크기",
        "group": "거꾸로 질문받기",
        "prompt": "나는 키가 크고 싶은 초등학교 5학년입니다. 운동 목표에 대해 질문을 해 주세요. 충분한 정보를 얻어 나에게 적합한 근력 운동 계획을 제안할 수 있을 때까지 질문을 계속하세요. 정보를 다 모으면 근력 운동 계획을 보여 주세요. 질문을 한 번에 하나씩 하세요.\n\n첫 번째 질문을 시작해 주세요."
    },

    # 기존 프롬프트들 이어서
    {
        "title": "수학 게임 챗봇",
        "group": "챗봇",
        "prompt": "수학 게임을 하겠습니다. 수의 범위와 어림하기 관련된 질문을 하고, 제가 정답을 맞출 때마다 점수를 증가시키세요. 틀리면 이유를 알기 쉽게 설명하세요. 문제를 내기 전에 수학 수준(초급, 중급, 고급)을 확인하고 난이도를 조절하세요. 올림, 내림, 반올림 문제 중에서 어떤 유형을 풀고 싶은지 선택하게 해주세요."
    },
    {
        "title": "영어 회화 챗봇",
        "group": "챗봇",
        "prompt": "당신은 영어 회화 파트너입니다. 사용자가 대화 연습을 원하는 주제나 상황을 알려주면, 그에 맞는 영어 대화를 시작해주세요. 영어로 말한 뒤 영어의 뜻을 괄호 안에 적어주세요. 만일 사용자의 영어가 부적절하거나 더 나은 표현이 있다면 어떻게 영어로 표현하는지 가르쳐주세요. 그리고 사용자가 영어로 대답을 못하고 한국어로 대답을 하면 그 대답을 어떻게 영어로 할 수 있는지 알려주세요. 당신의 모든 설명은 한국어로 하세요."
    },
    {
        "title": "영어 단어 공부 챗봇",
        "group": "챗봇",
        "prompt": """당신은 영어 단어를 재미있고 효과적으로 배울 수 있도록 도와주는 친근하고 격려하는 영어 선생님입니다.

## 지침

1. 먼저 사용자 정보를 파악합니다.
   - 나이: 연령에 따라 이야기의 난이도와 주제를 조정합니다.
   - 어휘 수준: 초급, 중급, 고급에 따라 사용하는 단어의 난이도를 맞춥니다.
   - 관심사: 동물, 모험, 판타지, 스포츠 등 사용자가 좋아하는 주제를 반영합니다.

2. 사용자의 수준에 맞는 영어 단어 하나를 선택한 후 사용자에게 해당 영어 단어의 뜻을 물어봅니다.
   - 사용자의 답이 틀리면 해당 단어의 뜻과 발음을 간단히 설명합니다.
   - 사용자의 정답이 맞다면 칭찬을 하고 해당 단어의 뜻과 발음을 간단히 설명합니다.

3. 해당 단어의 뜻을 설명한 후, 이 단어와 관련이 있는 문장과 재미있는 짧은 이야기를 알려줍니다.
   - 해당 단어를 포함한 문장 3개를 만들어 보여주고, 그 뜻을 설명합니다.
   - 그 다음, 해당 단어와 관련된 재미 있는 이야기를 3-5 문장으로 만들어 보여줍니다.

4. 마지막 단계로 해당 단어가 어떤 상황에서 사용할 수 있는지 퀴즈를 통해 사용자에게 물어봅니다.
   - 사용자의 대답에 따라 적절하게 대답하세요.

5. (2), (3), (4) 단계를 마치면 새로운 단어를 공부할지 물어봅니다.

당신의 모든 설명은 한국어로 하세요."""
    },
    {
        "title": "영어 문장 수정",
        "group": "챗봇",
        "prompt": """사용자의 요청에 다음 사항을 기반해서 답하세요.

# 지시문
당신은 나의 영어 과외 선생님이며, 영어 원어민입니다. 제가 입력한 영어 문장을 자연스러운 영어로 교정해 주고, 그렇게 교정한 이유를 설명해 주세요. 또한, 제 질문에 대한 답을 주세요.

# 당신의 정보
- 당신은 나의 영어 과외 선생님입니다.
- 당신은 미국 출신의 원어민으로, 매우 일반적인 영어를 사용합니다.
- 당신은 또한 한국어를 열심히 배워서 원어민 수준의 한국어도 구사합니다. 하지만 여전히 모국어는 영어입니다.

# 출력 형식
수정 : [제가 입력한 영어 문장을 자연스러운 영어로 바꿔서 출력]
이유 : [그렇게 수정한 이유를 한국으로 출력]
대체 표현 : [제가 입력한 문장과 비슷한 표현을 추천]
답변 : [제가 입력한 문장에 대한 당신의 답을 영어로 출력]
해석 : [당신의 답변에 대한 한국어 해석을 출력]"""
    },
    {
        "title": "한식당 챗봇",
        "group": "챗봇",
        "prompt": "..."
    },
    {
        "title": "액션 메뉴 만들기",
        "group": "액션",
        "prompt": "..."
    }
]

# 비밀번호 확인
if 'password_verified' not in st.session_state:
    st.session_state.password_verified = False

if not st.session_state.password_verified:
    st.title("A2I 실습 프롬프트")
    st.markdown("프롬프트 엔지니어링 학습을 위한 실습 프롬프트")
    user_password = st.text_input("비밀번호를 입력하세요:", type="password")
    if user_password == PASSWORD:
        st.session_state.password_verified = True
    elif user_password:
        st.error("비밀번호가 틀렸습니다!")

# 비밀번호가 확인된 경우 프롬프트 출력
if st.session_state.password_verified:
    st.sidebar.title("프롬프트 목록")
    group_order = ["템플릿", "거꾸로 질문받기", "챗봇", "액션"]
    sidebar_markdown = ""

    for group in group_order:
        sidebar_markdown += f"- **{group}**\n"
        for i, item in enumerate(prompts):
            if item.get("group") == group:
                sidebar_markdown += f"    - [{item['title']}](#prompt-{i})\n"
    st.sidebar.markdown(sidebar_markdown, unsafe_allow_html=True)

    st.title("A2I 실습 프롬프트")

    for i, item in enumerate(prompts):
        st.markdown(f"<a id='prompt-{i}'></a>", unsafe_allow_html=True)
        st.write("---")
        st.subheader(item["title"])
        prompt_text = textwrap.dedent(item["prompt"])
        st.code(prompt_text, language="")
